<ion-content [fullscreen]="true">

  <form [formGroup]="editorForm" (ngSubmit)="onSubmit()" *ngIf="editorFormActive">

    <swiper  style="min-height: 500px;" #swiper [config]="swiperConfig">

      <!-- PRODUCT PICK ------------------------------------------------------------------------------------------>
      <ng-template swiperSlide >
        <app-product-swiper
          [isUpdate]="true"
          [warehouseId] = "warehouseId"
          [productsSwiper]="[]"
          [isProductPicked]="true"
          (productEmmiter)="onProductPicked($event)"
          (dismissEmmiter)="this.dismiss()"
          (doneWithChangesEmmiter)="lastSlide()"
        ></app-product-swiper>
      </ng-template>

      <!-- PRODUCT HAVE SN --------------------------------------------------------------------------------------->
      <ng-template swiperSlide>
        <app-sncodes-swiper
          *ngIf="product && product.hasSN && warehouseId" swiperSlide

          [isUpdate]="true"
          [warehouseId] = "warehouseId"
          [isProductWithSN]="false"
          [productId]   = "product.id"
          [productsSwiper]="[]"
          (productSNCodeEmmiter)="onPickSNCode($event)"
          (dismissEmmiter)="this.dismiss()"
          (slideToPreviousEmmiter)="previousSlide()"
          (doneWithChangesEmmiter)="lastSlide()"
        ></app-sncodes-swiper>
      </ng-template>

      <!-- PRODUCT DONT HAVE SN ---------------------------------------------------------------------------------->
      <ng-template swiperSlide>

        <ion-header>
          <ion-toolbar>
            <ion-icon  name="arrow-back-outline" slot="start" size="large" class="pointer ion-padding-start" (click)="previousSlide()"></ion-icon>

            <ion-title class="ion-text-center ion-margin-vertical">
              {{ (task ? 'Izmeni' : 'Dodaj') }} količinu proizvoda
            </ion-title>
            <ion-icon size="large" class="ion-padding pointer" slot="end" (click)="dismiss()" name="close-outline"></ion-icon>
          </ion-toolbar>
        </ion-header>

        <ion-grid>

          <ion-row class="ion-justify-content-end">
            <ion-col sizeXl="5">
              <ion-button color="light" size="default" (click)="redirectToCoworker(true)">
                Završi sa izmenama

              </ion-button>
            </ion-col>
            <ion-col sizeXl="5">
              <ion-button color="primary" size="default" [disabled]="editorForm.controls.quantityUsed.invalid" (click)="redirectToCoworker(false)">
                Dodaj kolegu
                <ion-icon name="chevron-forward-outline"></ion-icon>
              </ion-button>
            </ion-col>
          </ion-row>

          <ion-row class="ion-padding-start">
            <ion-col sizeXl="10">
              <ion-label>Količina u magacinu: {{productQuantity}}</ion-label>
            </ion-col>
          </ion-row>

          <ion-row class="ion-justify-content-center">
            <ion-col sizeXl="12">
              <ion-item >
                <ion-label position="floating" for="quantityUsed">Iskorišćena količina</ion-label>
                <ion-input min="1"  id="quantityUsed" formControlName="quantityUsed" type="number"></ion-input>
              </ion-item>
              <div *ngIf="editorForm.controls.quantityUsed.invalid && editorForm.controls.quantityUsed.errors?.min">
                <ion-label color="danger">Minimalna količina proizvoda je 1</ion-label>
              </div>
              <div *ngIf="editorForm.controls.quantityUsed.invalid && editorForm.controls.quantityUsed.errors?.max">
                <ion-label color="danger">Prekoračili ste količinu</ion-label>
              </div>
            </ion-col>
          </ion-row>
        </ion-grid>

      </ng-template>

      <!-- ADD COWORKER --------------------------------------------------------------------------------------------->
      <ng-template swiperSlide>
        <app-user-swiper
          [isUpdate]="true"
          [mainWorkerId] = "mainWorker.id"
          (coworkerEmmiter)="onPickCoworker($event)"
          (doesntHaveCoworkerEmmiter)="onNoCoworker()"
          (dismissEmmiter)="this.dismiss()"
          (doneWithChangesEmmiter)="lastSlide()"
          [isCoworkerPicked] = "true"
         ></app-user-swiper>

      </ng-template>

        <!-- SUBMIT -------------------------------------------------------------------------------------------------->
      <ng-template swiperSlide>

          <ion-header>
            <ion-toolbar>
              <ion-icon  name="arrow-back-outline" slot="start" size="large" class="pointer ion-padding-start" (click)="previousSlide()"></ion-icon>

              <ion-title class="ion-text-center ion-margin-vertical">
                {{ (task ? 'Izmeni' : 'Dodaj') }} zadatak
              </ion-title>
              <ion-icon size="large" class="ion-padding pointer" slot="end" (click)="dismiss()" name="close-outline"></ion-icon>
            </ion-toolbar>
          </ion-header>

          <ion-grid>

            <ion-row  class="ion-justify-content-end ion-padding-start">
              <ion-col *ngIf="product"  sizeXl="6">
                <p><strong>{{ product.name }}</strong></p>
              </ion-col>
              <ion-col sizeXl="4">
                <ion-button (click)="redirectTo(0)" color="light" expand="full">{{product ? 'Izmeni proizvod' : 'Dodaj proizvod'}}</ion-button>
              </ion-col>
            </ion-row>

            <ion-row class="ion-justify-content-end ion-padding-start" *ngIf="this.product && this.product.hasSN && this.productState">
              <ion-col readonly="true" sizeXl="6">
                <p><strong>SN: {{ editorForm.controls.sn.value }}</strong></p>
              </ion-col>
              <ion-col sizeXl="4">
                <ion-button (click)="redirectTo(1)" color="light" expand="full">Izmeni SN</ion-button>
              </ion-col>
            </ion-row>

            <ion-row class="ion-justify-content-end ion-padding-start" *ngIf="this.product && !this.product.hasSN" >
              <ion-col  sizeXl="6" class="ion-justify-content-start">
                <p><strong>Količina: {{ editorForm.controls.quantityUsed.value }}</strong></p>
              </ion-col>
              <ion-col sizeXl="4">
                <ion-button (click)="redirectTo(2)" color="light" expand="full">Izmeni količinu</ion-button>
              </ion-col>
            </ion-row>

            <ion-row class="ion-justify-content-end ion-padding-start">
              <ion-col  *ngIf="coworker"  sizeXl="6">
                <p><strong>{{ coworker.name + ' ' + coworker.surname }}</strong></p>
              </ion-col>

              <ion-col sizeXl="4">
                <ion-button (click)="redirectTo(3)" color="light" expand="full" >{{coworker ? 'Izmeni radnika' : 'Dodaj radnika'}}</ion-button>
              </ion-col>

            </ion-row>

            <ion-row class="ion-justify-content-center ion-margin-vertical">
              <ion-button [disabled]="editorForm.invalid"  type="submit" color="primary" >{{ (task ? 'Sačuvaj' : 'Dodaj') }}</ion-button>
            </ion-row>

          </ion-grid>
        </ng-template>

    </swiper>

  </form>

</ion-content>
